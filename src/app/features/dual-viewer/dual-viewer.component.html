<div class="dual-viewer-container">
  <!-- Baseline Viewer Region (NFR-3.3, NFR-3.4) -->
  <section
    class="viewer-panel"
    [class.active]="activeViewer === 'baseline'"
    [class.inactive]="activeViewer !== 'baseline'"
    role="region"
    aria-labelledby="baseline-viewer-label"
    [attr.aria-hidden]="activeViewer !== 'baseline'">
    <header class="viewer-header" id="baseline-viewer-label">
      <div class="viewer-title">
        <h2 class="viewer-heading">{{ leftTitle }}</h2>
        <span class="viewer-subtitle">Baseline detections</span>
      </div>
      <div class="viewer-meta" aria-label="Baseline detection count">
        {{ baselineDetections.length || 0 }} boxes
      </div>
    </header>
    <app-scene-viewer
      viewerId="baseline"
      [sharedPointGeometry]="sharedGeometry"
      [detections]="baselineDetections"
      [diffMode]="effectiveDiffMode"
      [diffClassification]="baselineDiffClassification"
      [paneLabel]="'Baseline'"
      [showFps]="showFps" />
  </section>

  <!-- Crossfade Toggle Button (WP-2.1.1) -->
  <button
    class="crossfade-toggle"
    type="button"
    (click)="toggleActiveViewer()"
    [disabled]="isTransitioning"
    [attr.aria-label]="
      'Switch to ' + (activeViewer === 'baseline' ? 'AGILE3D' : 'Baseline') + ' viewer'
    "
    [attr.aria-pressed]="activeViewer === 'agile3d'">
    <span class="toggle-icon" aria-hidden="true">â‡„</span>
    <span class="toggle-text">
      {{ activeViewer === 'baseline' ? 'Show AGILE3D' : 'Show Baseline' }}
    </span>
  </button>

  <!-- FP Only Toggle -->
  <button
    class="fp-toggle"
    type="button"
    (click)="toggleFPOnly()"
    [attr.aria-pressed]="effectiveDiffMode === 'fp'"
    aria-label="Toggle show only false positives"
    title="Show only false positives">
    FP Only: {{ effectiveDiffMode === 'fp' ? 'On' : 'Off' }}
  </button>

  <!-- AGILE3D Viewer Region (NFR-3.3, NFR-3.4) -->
  <section
    class="viewer-panel"
    [class.active]="activeViewer === 'agile3d'"
    [class.inactive]="activeViewer !== 'agile3d'"
    role="region"
    aria-labelledby="agile3d-viewer-label"
    [attr.aria-hidden]="activeViewer !== 'agile3d'">
    <header class="viewer-header" id="agile3d-viewer-label">
      <div class="viewer-title">
        <h2 class="viewer-heading">{{ rightTitle }}</h2>
        <span class="viewer-subtitle">AGILE3D detections</span>
      </div>
      <div class="viewer-meta" aria-label="AGILE3D detection count">
        {{ agile3dDetections.length || 0 }} boxes
      </div>
    </header>
    <app-scene-viewer
      viewerId="agile3d"
      [sharedPointGeometry]="sharedGeometry"
      [detections]="agile3dDetections"
      [diffMode]="effectiveDiffMode"
      [diffClassification]="agile3dDiffClassification"
      [paneLabel]="'AGILE3D'"
      [showFps]="showFps" />
    <div class="no-dets-overlay" *ngIf="!agile3dDetections || agile3dDetections.length === 0">
      No detections for {{ rightTitle }}
    </div>
  </section>
</div>
