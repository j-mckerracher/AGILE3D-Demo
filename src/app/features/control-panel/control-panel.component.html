<div class="control-panel-container">
  <header class="panel-header">
    <h2 class="panel-title">CONTROL PANEL</h2>
    <p class="panel-subtitle">Simulation Parameters</p>
  </header>

  <!-- Primary Controls Section (WP-2.2.1) -->
  <section class="primary-controls" aria-label="Primary controls">
    <form [formGroup]="primaryForm" class="primary-grid" (submit)="$event.preventDefault()">
      <!-- Scene selector - Changed to checkboxes for sidebar -->
      <div class="control-group scene-group">
        <fieldset>
          <legend id="scene-legend" class="control-label">SCENE</legend>
          <mat-button-toggle-group
            aria-labelledby="scene-legend"
            formControlName="scene"
            class="scene-toggle-group scene-vertical"
          >
            <mat-button-toggle
              value="vehicle-heavy"
              matTooltip="Vehicle-heavy traffic scenario"
              aria-label="Select vehicle-heavy scene"
            >
              Vehicle-Heavy
            </mat-button-toggle>
            <mat-button-toggle
              value="pedestrian-heavy"
              matTooltip="Pedestrian-heavy traffic scenario"
              aria-label="Select pedestrian-heavy scene"
            >
              Pedestrian-Heavy
            </mat-button-toggle>
            <mat-button-toggle
              value="mixed"
              matTooltip="Mixed traffic scenario"
              aria-label="Select mixed scene"
            >
              Mixed
            </mat-button-toggle>
          </mat-button-toggle-group>
        </fieldset>
      </div>

      <!-- Voxel size slider -->
      <div class="control-group voxel-group">
        <fieldset>
          <legend id="voxel-legend" class="control-label">VOXEL SIZE</legend>
          <mat-slider
            class="full-width"
            [min]="0.16"
            [max]="0.64"
            [step]="0.08"
            [discrete]="true"
            aria-labelledby="voxel-legend"
            matTooltip="Spatial resolution (smaller is finer, higher accuracy but slower)"
          >
            <input matSliderThumb formControlName="voxelSize" />
          </mat-slider>
          <div class="value-label" aria-hidden="true">{{ primaryForm.value.voxelSize }} m</div>
        </fieldset>
      </div>

      <!-- Contention slider with labeled markers -->
      <div class="control-group contention-group">
        <fieldset>
          <legend id="contention-legend" class="control-label">CONTENTION</legend>
          <mat-slider
            class="full-width"
            [min]="0"
            [max]="100"
            [step]="1"
            aria-labelledby="contention-legend"
            matTooltip="GPU resource contention percentage"
          >
            <input matSliderThumb formControlName="contention" />
          </mat-slider>
          <div class="tick-labels" aria-hidden="true">
            <span class="tick">0%</span>
            <span class="tick">38%</span>
            <span class="tick">45%</span>
            <span class="tick">64%</span>
            <span class="tick">67%</span>
          </div>
          <div class="value-label" aria-live="polite">{{ primaryForm.value.contention }}%</div>
        </fieldset>
      </div>

      <!-- Latency SLO slider -->
      <div class="control-group slo-group">
        <fieldset>
          <legend id="slo-legend" class="control-label">LATENCY SLO</legend>
          <mat-slider
            class="full-width"
            [min]="100"
            [max]="500"
            [step]="10"
            aria-labelledby="slo-legend"
            matTooltip="Target latency Service Level Objective in milliseconds"
          >
            <input matSliderThumb formControlName="sloMs" />
          </mat-slider>
          <div class="value-label" aria-live="polite">{{ primaryForm.value.sloMs }} ms</div>
        </fieldset>
      </div>

      <!-- Baseline branch selector -->
      <div class="control-group baseline-branch-group">
        <mat-form-field appearance="fill" class="full-width dark-select">
          <mat-label>BASELINE BRANCH</mat-label>
          <mat-select
            formControlName="baselineBranch"
            [disabled]="baselineOptions.length === 0"
            aria-label="Select baseline detection branch"
          >
            <mat-option *ngFor="let branch of baselineOptions" [value]="branch">
              {{ branch }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- AGILE3D branch selector -->
      <div class="control-group agile-branch-group">
        <mat-form-field appearance="fill" class="full-width dark-select">
          <mat-label>AGILE3D BRANCH</mat-label>
          <mat-select
            formControlName="activeBranch"
            [disabled]="agileOptions.length === 0"
            aria-label="Select AGILE3D detection branch"
          >
            <mat-option *ngFor="let branch of agileOptions" [value]="branch">
              {{ branch }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </form>
  </section>

  <!-- Advanced Controls Section (WP-2.2.2) -->
  <section class="advanced-controls-section" aria-label="Advanced controls">
    <app-advanced-controls />
  </section>
</div>
